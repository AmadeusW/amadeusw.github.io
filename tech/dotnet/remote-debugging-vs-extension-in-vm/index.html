<!doctype html><html lang=en><head><title>Amadeus' page</title><link rel=stylesheet href=//amadeusw.com/css/style.css><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Personal website of Amadeusz Wieczorek about projects, travel and programming."></head><body><header id=title><a href=//amadeusw.com><h2>Amadeusz Wieczorek</h2></a></header><article class=tech><header id=postheader class=accent_tech><h3>Remote debugging of VS extension in VM</h3></header><main><p>At Code Connect we&rsquo;re developing Visual Studio extensions. We use various configurations of virtual machines to make sure that the extensions work on client machines. In one case a bug was reproducible only in Visual Studio 2013 on one of the virtual machines. It was fixed through remote debugging connection to a virtual machine.</p><p>Remote debugging is very straightforward but requires a non trivial setup:</p><hr><h2 id=download-remote-debugging-tools>Download remote debugging tools</h2><p>You must install remote debugging tools <em>on the debugged machine</em> for the exact version of Visual Studio that you have installed on your <em>host machine</em>. 2015 RC, 2015 RC2 and future 2015 all have different remote tools. I got mine from <a href=https://www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs.aspx>Visual Studio download page</a> under <code>Additional Tools > Remote Tools for Visual Studio 2015 RC</code>.</p><h1 id=create-an-administrator-user-for-use-with-the-debugger>Create an administrator user for use with the debugger</h1><p>The Visual Studio Remote Debugger Configuration Wizard will ask you for an user account with privilege to <code>Log on as a service</code>, network access rights, and if possible, administrative privileges. I log in to my Windows 8 machines using hotmail login, and I don&rsquo;t know what&rsquo;s the <strong>user name</strong> for my account. So I created a new user with name <code>admin</code>.</p><p><em>Psst! <a href=https://twitter.com/HiAmadeus>Let me know</a> if you know a way to get name for user logged in via Microsoft Account.</em></p><h1 id=grant-right-to-log-in-as-a-service>Grant right to log in as a service</h1><p>After creating an user,</p><ul><li>Launch <code>Administrative Tools</code> directly or from control panel, and go to <code>Local Security Policy</code></li></ul><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/beforeWizard.png alt="screenshot 1"></p><ul><li><p>In the console tree, double-click Local Policies, and then click User Rights Assignment.</p></li><li><p>In the details pane, double-click Log on as a service.</p></li><li><p>Click Add User or Group, and then add the appropriate account: simply type the name of the user and click <code>Check Names</code> to validate it.</p></li></ul><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/beforeWizard2.png alt="screenshot 1"></p><p><a href="https://technet.microsoft.com/en-ca/library/cc794944(v=ws.10).aspx">Instructions via technet</a></p><h1 id=install-remote-debugging-tools>Install remote debugging tools</h1><p>When you first run the tools, you may receive information that the firewall settings will change. Proceed.</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/firewall.png alt=screenshot></p><p>Next, provide credentials of the user that you&rsquo;ve created earlier</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/wizard1.PNG alt=screenshot></p><p>Continue through the wizard, and you should be set up!</p><h2 id=start-the-debugging-session>Start the debugging session</h2><p>Start Visual Studio in the remote machine. In your development Visual Studio, go to <code>Debug > Attach to Process...</code> and click <code>Find...</code> to find remote debuggers on your network.</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/attach.png alt=screenshot></p><p>If you don&rsquo;t see your virtual machine there, check network connectivity - see if you can ping the VM from the host and vice versa.</p><p>If you see your virtual machine, connect to it, and then find the process that you want to attach to. Visual Studio extensions live within the Visual Studio process <code>devenv.exe</code></p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/attach2.png alt=screenshot></p><h1 id=debugging-vs-extensions-initialization-code>Debugging VS Extension&rsquo;s initialization code</h1><p>The extension I&rsquo;m working on has its <code>Package</code> decorated with attribute <code>[ProvideAutoLoad(UIContextGuids80.SolutionExists)]</code> which causes Visual Studio to start the extension when a solution first loads. This gives us a convenient opportunity to attach to a running <code>devenv.exe</code> process and debug the initialization of the extension.</p><p>Initially, before you load a solution, the breakpoint icons will be hollow.</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/breakpoint1.PNG alt=screenshot></p><p>As soon as you load a solution, Visual Studio will load your extension and the breakpoint will be hit.</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/breakpoint2.PNG alt=screenshot></p><p>Congratulations! You are now debugging your extension inside Visual Studio inside the virtual machine!</p><hr><h2 id=troubleshooting-establish-connectivity>Troubleshooting: establish connectivity</h2><p>If the host Visual Studio can&rsquo;t detect the remote debugger in the virtual machine, see if you can ping the VM from the host and vice versa. I couldn&rsquo;t get it to work at first, but after restarting both the host and the virtual machine, I could connect on default settings:</p><p><img src=//amadeusw.com/techBlogData//remote-debugging-vs-extension-in-vm/vmsettings.png alt=screenshot></p></main></article><footer><span><a href=/about/>//AW</a></span>
<span><a href=#>Scroll to top</a></span></footer></body></html>