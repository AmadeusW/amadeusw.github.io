<!doctype html><html lang=en><head><title>Amadeus' page</title><link rel=stylesheet href=//amadeusw.com/css/style.css><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Personal website of Amadeusz Wieczorek about projects, travel and programming."></head><body><header id=title><a href=//amadeusw.com><h2>Amadeusz Wieczorek</h2></a></header><article class=tech><header id=postheader class=accent_tech><h3>Using Fiddler to debug Azure exceptions</h3></header><main><p>Today I was fixing <code>Unexpected response code for operation : 12</code> exception thrown from <code>ExecuteBatch</code> method of <code>Microsoft.WindowsAzure.Storage.Table.CloudTable</code>. The exception doesn&rsquo;t have much useful information to aid debugging. Both <code>InnerException</code> and <code>Data</code> properties are empty.</p><p><img src=//amadeusw.com/techBlogData//debugging-azure-with-fiddler/exception.png alt="exception screenshot"></p><p>Quick search shows that this exception could mean pretty much anything, but common error scenarios follow a pattern.</p><ul><li><a href=https://stackoverflow.com/questions/18170920/azure-table-storage-error-unexpected-response-code-for-operation-99>Unexpected response code for operation : 99</a> - because the batch operation is limited to 100 elements.</li><li><a href=https://stackoverflow.com/questions/19976862/unexpected-response-code-from-cloudtable-executebatch>Unexpected response code for operation : 1</a> - the second <code>ITableEntity</code> has a different <code>PartitionKey</code> or the same <code>RowKey</code> than the first one</li></ul><p><em>Unexpected response code for operation</em> errors indicate a zero-based index of the element whose processing triggered an exception. Why would the thirteenth element trigger an exception in my app? Following <a href=http://stackoverflow.com/a/20876503/879243>Guarav&rsquo;s suggestion in the comment</a> I ran <a href=http://www.telerik.com/fiddler>Fiddler</a> and found that Azure&rsquo;s exceptions actually carry useful debugging information!</p><p>Run Fiddler. In the left side pane, find the entry associated with your app&rsquo;s communication with Azure. In my case, the hostname was <code>&lt;tablename>.table.core.windows.net</code>, the URL was <code>$/batch</code> and the process was <code>iisexpress</code>.
Then, in the bottom-right pane click <code>TextView</code> to see the server&rsquo;s response
<img src=//amadeusw.com/techBlogData//debugging-azure-with-fiddler/fiddler.png alt="fiddler screenshot"></p><p>The text view contained more detailed error information:</p><pre tabindex=0><code>{&#34;odata.error&#34;:{&#34;code&#34;:&#34;PropertyValueTooLarge&#34;,&#34;message&#34;:{&#34;lang&#34;:&#34;en-US&#34;,&#34;value&#34;:&#34;12:The property value exceeds the maximum allowed size (64KB). If the property value is a string, it is UTF-16 encoded and the maximum number of characters should be 32K or less.\nRequestId:c0679755-0002-000c-141a-e4596c000000\nTime:2015-08-31T18:28:47.4559166Z&#34;}}}
</code></pre><p>It looks like I tried to send too big of a payload. <code>TextView</code> in the top-right pane shows exactly my request, where the thirteenth element was indeed too long. For now, I&rsquo;ll trim the string since the information isn&rsquo;t all that useful,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> AZURE_STRING_MAX_LENGTH = <span style=color:#ae81ff>32000</span>;
</span></span><span style=display:flex><span>. . .
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (sourceData.Length &gt; AZURE_STRING_MAX_LENGTH)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    myTableEntity.Data = sourceData.Substring(<span style=color:#ae81ff>0</span>, AZURE_STRING_MAX_LENGTH);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><pre tabindex=0><code>
# Another approach
A much simpler approach is apparent when you catch the specific exception type. This is a `StorageException` and its `RequestInformation` property contains more information.

```csharp
catch (StorageException ex)
{
    var innerException = ex.RequestInformation.Exception;
```
</code></pre></main></article><footer><span><a href=/about/>//AW</a></span>
<span><a href=#>Scroll to top</a></span></footer></body></html>